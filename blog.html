<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waves - Modern Blogging Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://i.postimg.cc/TY9t0sRH/5061152.png"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .glass-card {
        background: rgba(42, 50, 68, 0.5);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .sidebar-glass {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
      }
      .main-content::-webkit-scrollbar {
        width: 8px;
      }
      .main-content::-webkit-scrollbar-track {
        background: transparent;
      }
      .main-content::-webkit-scrollbar-thumb {
        background: #4a5568;
        border-radius: 10px;
      }
      .main-content::-webkit-scrollbar-thumb:hover {
        background: #718096;
      }
      .loading-spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 3px solid #fff;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-slate-900 text-slate-300 overflow-hidden">
    <div id="app-container" class="flex h-screen">
      <div
        id="sidebar-overlay"
        class="fixed inset-0 bg-black bg-opacity-60 z-30 hidden md:hidden"
      ></div>

      <aside
        id="left-sidebar"
        class="w-64 h-full sidebar-glass p-6 flex-shrink-0 flex flex-col justify-between fixed top-0 left-0 z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:relative md:translate-x-0"
      >
        <div>
          <div class="flex justify-between items-center mb-10">
            <h1 class="text-2xl font-bold text-white">Waves</h1>
            <button
              id="close-sidebar"
              class="md:hidden text-slate-400 hover:text-white"
            >
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
          </div>
          <nav class="space-y-4">
            <a
              href="#"
              id="nav-home"
              class="flex items-center space-x-3 text-white bg-slate-700/50 px-3 py-2 rounded-lg"
            >
              <i data-lucide="layout-dashboard"></i>
              <span>Discover</span>
            </a>
            <a
              href="#"
              id="nav-trending"
              class="flex items-center space-x-3 hover:text-white hover:bg-slate-700/50 px-3 py-2 rounded-lg transition-colors"
            >
              <i data-lucide="flame"></i>
              <span>Trending</span>
            </a>
            <a
              href="#"
              id="nav-following"
              class="flex items-center space-x-3 hover:text-white hover:bg-slate-700/50 px-3 py-2 rounded-lg transition-colors"
            >
              <i data-lucide="users"></i>
              <span>Following</span>
            </a>
            <a
              href="#"
              id="nav-profile"
              class="flex items-center space-x-3 hover:text-white hover:bg-slate-700/50 px-3 py-2 rounded-lg transition-colors"
            >
              <i data-lucide="user"></i>
              <span>My Profile</span>
            </a>
          </nav>

          <h2
            class="text-sm font-semibold tracking-widest text-slate-400 mt-10 mb-4"
          >
            CATEGORY
          </h2>
          <nav id="category-nav" class="space-y-4">
            <a
              href="#"
              class="category-link flex items-center space-x-3 hover:text-white transition-colors"
              data-category="Technology"
              ><i data-lucide="cpu"></i><span>Technology</span></a
            >
            <a
              href="#"
              class="category-link flex items-center space-x-3 hover:text-white transition-colors"
              data-category="Travel"
              ><i data-lucide="plane"></i><span>Travel</span></a
            >
            <a
              href="#"
              class="category-link flex items-center space-x-3 hover:text-white transition-colors"
              data-category="Lifestyle"
              ><i data-lucide="party-popper"></i><span>Lifestyle</span></a
            >
            <a
              href="#"
              class="category-link flex items-center space-x-3 hover:text-white transition-colors"
              data-category="Food"
              ><i data-lucide="utensils"></i><span>Food</span></a
            >
            <a
              href="#"
              class="category-link flex items-center space-x-3 hover:text-white transition-colors"
              data-category="Health"
              ><i data-lucide="heart-pulse"></i><span>Health</span></a
            >
          </nav>
        </div>
        <button
          id="logout-btn"
          class="w-full flex items-center justify-center space-x-3 bg-red-800/50 hover:bg-red-700 text-white px-3 py-2 rounded-lg transition-colors"
        >
          <i data-lucide="log-out"></i>
          <span>Logout</span>
        </button>
      </aside>

      <main class="flex-1 flex flex-col h-screen">
        <header
          class="flex-shrink-0 bg-slate-900/50 backdrop-blur-sm z-20 flex items-center justify-between p-4 md:p-6 border-b border-slate-700/50"
        >
          <div class="flex items-center">
            <button
              id="sidebar-toggle"
              class="md:hidden mr-4 text-slate-400 hover:text-white"
            >
              <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <div class="relative w-full max-w-xs sm:max-w-md">
              <i
                data-lucide="search"
                class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
              ></i>
              <input
                type="text"
                id="search-bar"
                placeholder="Search articles or users..."
                class="w-full bg-slate-800/80 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>
          <div class="flex items-center space-x-2 sm:space-x-4">
            <button
              id="create-post-btn"
              class="bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2"
            >
              <i data-lucide="plus-circle" class="w-5 h-5"></i>
              <span class="hidden sm:inline">Create Post</span>
            </button>
            <div
              id="user-profile-header"
              class="flex items-center space-x-3 cursor-pointer"
            >
              <img
                id="current-user-avatar-header"
                src=""
                alt="User"
                class="w-10 h-10 rounded-full"
              />
              <div class="hidden md:block">
                <span
                  id="current-user-name-header"
                  class="text-white font-semibold"
                ></span>
              </div>
            </div>
          </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
          <div
            id="main-content-area"
            class="flex-1 p-4 sm:p-6 overflow-y-auto main-content"
          >
            <div id="home-view"></div>
            <div id="article-view" class="hidden"></div>
            <div id="profile-view" class="hidden"></div>
            <div id="create-edit-view" class="hidden"></div>
            <div id="search-results-view" class="hidden"></div>
            <div id="login-view" class="hidden"></div>
            <div id="register-view" class="hidden"></div>
            <div id="edit-profile-view" class="hidden"></div>
          </div>

          <aside
            class="w-80 h-full glass-card p-6 flex-shrink-0 hidden lg:block overflow-y-auto main-content"
          >
            <div id="popular-authors-container">
              <h3 class="text-lg font-semibold text-white mb-4">
                Popular Authors
              </h3>
              <div id="popular-authors-list" class="space-y-4"></div>
            </div>
            <div id="popular-tags-container" class="mt-8">
              <h3 class="text-lg font-semibold text-white mb-4">
                Popular Topics
              </h3>
              <div id="popular-tags-list" class="flex flex-wrap gap-2"></div>
            </div>
          </aside>
        </div>
      </main>
    </div>

    <div
      id="share-modal"
      class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center hidden z-50 p-4"
    >
      <div class="glass-card rounded-xl p-8 max-w-sm w-full relative">
        <button
          id="close-share-modal"
          class="absolute top-4 right-4 text-slate-400 hover:text-white"
        >
          <i data-lucide="x"></i>
        </button>
        <h3 class="text-xl font-bold text-white text-center mb-6">
          Share this article
        </h3>
        <div class="flex justify-center space-x-4">
          <a
            href="#"
            target="_blank"
            class="share-link-twitter w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center hover:bg-sky-500 transition-colors"
            ><i data-lucide="twitter" class="w-8 h-8"></i
          ></a>
          <a
            href="#"
            target="_blank"
            class="share-link-facebook w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors"
            ><i data-lucide="facebook" class="w-8 h-8"></i
          ></a>
          <a
            href="#"
            target="_blank"
            class="share-link-linkedin w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center hover:bg-blue-800 transition-colors"
            ><i data-lucide="linkedin" class="w-8 h-8"></i
          ></a>
          <a
            href="#"
            target="_blank"
            class="share-link-whatsapp w-16 h-16 bg-slate-700 rounded-full flex items-center justify-center hover:bg-green-500 transition-colors"
            ><i data-lucide="message-circle" class="w-8 h-8"></i
          ></a>
        </div>
        <div class="mt-6 relative">
          <input
            type="text"
            id="share-url-input"
            readonly
            class="w-full bg-slate-700/80 border border-slate-600 rounded-lg pl-3 pr-12 py-2 text-white"
          />
          <button
            id="copy-share-url"
            class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white p-1"
          >
            <i data-lucide="copy"></i>
          </button>
          <span
            id="copy-feedback"
            class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-sm text-green-400 opacity-0 transition-opacity"
            >Copied!</span
          >
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
          apiKey: "AIzaSyBnfH6QG71y4jtd6EBIvRwqj9zswNOs66k",
          authDomain: "attender-71a9f.firebaseapp.com",
          databaseURL: "https://attender-71a9f-default-rtdb.firebaseio.com",
          projectId: "attender-71a9f",
          storageBucket: "attender-71a9f.firebasestorage.app",
          messagingSenderId: "773468419469",
          appId: "1:773468419469:web:029ed58b7b67f9a95fb9c4",
          measurementId: "G-VY3ZLPF9LG",
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        let db = { users: [], articles: [], comments: [] };
        let currentUser = null;

        const dbRef = {
          users: database.ref("users"),
          articles: database.ref("articles"),
          comments: database.ref("comments"),
        };

        function seedInitialData() {
          dbRef.articles.once("value", (snapshot) => {
            if (!snapshot.exists()) {
              console.log(
                "Database is empty. Seeding initial data for demonstration..."
              );
              const seedUsers = {
                user1: {
                  name: "Alex Johnson",
                  username: "alexj",
                  avatar: `https://ui-avatars.com/api/?name=Alex+Johnson&background=0D8ABC&color=fff`,
                  followers: [],
                  following: [],
                },
                user2: {
                  name: "Bella Creativa",
                  username: "bellac",
                  avatar: `https://ui-avatars.com/api/?name=Bella+Creativa&background=7F56D9&color=fff`,
                  followers: [],
                  following: [],
                },
              };

              const seedArticles = {
                article1: {
                  authorId: "user1",
                  title: "Exploring the Alps: A Hiker's Journey",
                  content:
                    "The Alps are one of the great mountain range systems of Europe, stretching approximately 1,200 kilometers across eight Alpine countries. The journey was breathtaking, with stunning vistas at every turn and challenging trails that tested our limits. We encountered diverse flora and fauna, truly a nature lover's paradise.",
                  category: "Travel",
                  image: "https://picsum.photos/200/300",
                  tags: ["travel", "hiking", "alps", "nature"],
                  likes: [],
                  views: 120,
                  createdAt: new Date("2025-10-18T10:00:00Z").toISOString(),
                },
                article2: {
                  authorId: "user2",
                  title: "The Future of AI in Web Development",
                  content:
                    "Artificial intelligence is rapidly changing the landscape of web development. From automated coding assistants to intelligent testing frameworks, AI is poised to become an indispensable tool for developers, promising to boost productivity and enhance the creative process.",
                  category: "Technology",
                  image: "https://picsum.photos/200/300",
                  tags: ["ai", "webdev", "technology", "programming"],
                  likes: [],
                  views: 250,
                  createdAt: new Date("2025-10-19T14:30:00Z").toISOString(),
                },
                article3: {
                  authorId: "user1",
                  title: "Mastering the Art of Sourdough Baking",
                  content:
                    "Baking sourdough bread is a rewarding experience that combines science and art. It requires patience and a feel for the dough, but the result is a delicious, crusty loaf with a complex flavor that is far superior to any store-bought bread. The key is a healthy starter and proper fermentation.",
                  category: "Food",
                  image: "https://picsum.photos/200/300",
                  tags: ["baking", "food", "sourdough", "lifestyle"],
                  likes: [],
                  views: 88,
                  createdAt: new Date("2025-10-17T09:00:00Z").toISOString(),
                },
              };
              dbRef.users.set(seedUsers);
              dbRef.articles.set(seedArticles);
            }
          });
        }
        seedInitialData();

        const mainContentArea = document.getElementById("main-content-area");
        const views = {
          home: document.getElementById("home-view"),
          article: document.getElementById("article-view"),
          profile: document.getElementById("profile-view"),
          createEdit: document.getElementById("create-edit-view"),
          searchResults: document.getElementById("search-results-view"),
          login: document.getElementById("login-view"),
          register: document.getElementById("register-view"),
          editProfile: document.getElementById("edit-profile-view"),
        };

        auth.onAuthStateChanged((user) => {
          if (user) {
            dbRef.users.child(user.uid).on("value", (snapshot) => {
              if (snapshot.exists()) {
                currentUser = {
                  uid: user.uid,
                  email: user.email,
                  profile: { id: snapshot.key, ...snapshot.val() },
                };
                initializeAppUI();
              }
            });
          } else {
            currentUser = null;
            showAuthUI();
          }
        });

        function handleRegister(event) {
          event.preventDefault();
          const email = event.target.email.value;
          const password = event.target.password.value;
          const displayName = event.target.displayName.value;
          const username = event.target.username.value;

          auth
            .createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
              const user = userCredential.user;
              const newUserProfile = {
                name: displayName,
                username: username,
                avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(
                  displayName
                )}&background=random&color=fff`,
                followers: [],
                following: [],
              };
              dbRef.users.child(user.uid).set(newUserProfile);
            })
            .catch((error) => alert(error.message));
        }

        function handleLogin(event) {
          event.preventDefault();
          const email = event.target.email.value;
          const password = event.target.password.value;
          auth
            .signInWithEmailAndPassword(email, password)
            .catch((error) => alert(error.message));
        }

        function handleLogout() {
          auth.signOut();
        }

        function initDatabaseListeners() {
          dbRef.users.on("value", (snapshot) => {
            db.users = snapshot.val()
              ? Object.keys(snapshot.val()).map((key) => ({
                  id: key,
                  ...snapshot.val()[key],
                }))
              : [];
            if (currentUser) renderSidebars();
          });

          dbRef.articles.on("value", (snapshot) => {
            db.articles = snapshot.val()
              ? Object.keys(snapshot.val()).map((key) => ({
                  id: key,
                  ...snapshot.val()[key],
                }))
              : [];
            const currentView = document.querySelector(
              "#main-content-area > div:not(.hidden)"
            );
            if (currentUser && currentView && currentView.id === "home-view") {
              renderHome();
            }
          });

          dbRef.comments.on("value", (snapshot) => {
            db.comments = snapshot.val()
              ? Object.keys(snapshot.val()).map((key) => ({
                  id: key,
                  ...snapshot.val()[key],
                }))
              : [];
            if (currentUser && !views.article.classList.contains("hidden")) {
              const articleId =
                views.article.querySelector("[data-article-id]")?.dataset
                  .articleId;
              if (articleId) {
                const commentsList = document.getElementById("comments-list");
                if (commentsList) {
                  commentsList.innerHTML = renderCommentsList(articleId);
                  lucide.createIcons();
                }
              }
            }
          });
        }

        const saveUser = (userId, userData) =>
          dbRef.users.child(userId).set(userData);
        const saveArticle = (articleId, articleData) =>
          dbRef.articles.child(articleId).set(articleData);
        const saveComment = (commentId, commentData) =>
          dbRef.comments.child(commentId).set(commentData);
        const deleteArticle = (articleId) =>
          dbRef.articles.child(articleId).remove();

        const getUser = (userId) => db.users.find((u) => u.id === userId);
        const timeAgo = (date) => {
          const seconds = Math.floor((new Date() - new Date(date)) / 1000);
          let interval = seconds / 31536000;
          if (interval > 1) return Math.floor(interval) + " years ago";
          interval = seconds / 2592000;
          if (interval > 1) return Math.floor(interval) + " months ago";
          interval = seconds / 86400;
          if (interval > 1) return Math.floor(interval) + " days ago";
          interval = seconds / 3600;
          if (interval > 1) return Math.floor(interval) + " hours ago";
          interval = seconds / 60;
          if (interval > 1) return Math.floor(interval) + " minutes ago";
          return Math.floor(seconds) + " seconds ago";
        };

        function switchView(viewName) {
          Object.values(views).forEach((v) => v.classList.add("hidden"));
          if (views[viewName]) {
            views[viewName].classList.remove("hidden");
            mainContentArea.scrollTop = 0;
          }
        }

        function initializeAppUI() {
          document.getElementById("app-container").classList.remove("hidden");
          renderCurrentUserHeader();
          renderHome();
          switchView("home");
          handleMobileSidebar();
          lucide.createIcons();
        }

        function showAuthUI() {
          renderLoginView();
          switchView("login");
          lucide.createIcons();
        }

        function renderCurrentUserHeader() {
          if (!currentUser) return;
          document.getElementById("current-user-avatar-header").src =
            currentUser.profile.avatar;
          document.getElementById("current-user-name-header").textContent =
            currentUser.profile.name;
        }

        function renderLoginView() {
          views.login.innerHTML = `<div class="flex items-center justify-center min-h-full"><div class="glass-card rounded-xl p-8 max-w-md w-full"><h2 class="text-3xl font-bold text-white text-center mb-6">Welcome Back</h2><form id="login-form"><div class="mb-4"><label for="email" class="block text-slate-400 mb-2">Email</label><input type="email" name="email" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><div class="mb-6"><label for="password" class="block text-slate-400 mb-2">Password</label><input type="password" name="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><button type="submit" class="w-full text-lg px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700">Login</button></form><p class="text-center mt-4">Don't have an account? <a href="#" id="show-register" class="text-blue-400 hover:underline">Sign up</a></p></div></div>`;
        }

        function renderRegisterView() {
          views.register.innerHTML = `<div class="flex items-center justify-center min-h-full"><div class="glass-card rounded-xl p-8 max-w-md w-full"><h2 class="text-3xl font-bold text-white text-center mb-6">Create Account</h2><form id="register-form"><div class="mb-4"><label for="displayName" class="block text-slate-400 mb-2">Display Name</label><input type="text" name="displayName" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><div class="mb-4"><label for="username" class="block text-slate-400 mb-2">Username</label><input type="text" name="username" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><div class="mb-4"><label for="email" class="block text-slate-400 mb-2">Email</label><input type="email" name="email" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><div class="mb-6"><label for="password" class="block text-slate-400 mb-2">Password</label><input type="password" name="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required></div><button type="submit" class="w-full text-lg px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700">Register</button></form><p class="text-center mt-4">Already have an account? <a href="#" id="show-login" class="text-blue-400 hover:underline">Log in</a></p></div></div>`;
        }

        function renderHome(articlesToRender = null, title = "Discover") {
          const articles =
            articlesToRender ||
            [...db.articles].sort(
              (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
            );
          if (db.articles.length === 0 && !articlesToRender) {
            views.home.innerHTML = `<div class="text-center py-10"><p class="text-slate-400 mt-4">No articles yet. Be the first to post!</p></div>`;
            return;
          }
          views.home.innerHTML = `<h2 class="text-3xl font-bold text-white mb-6">${title}</h2><div class="space-y-4">${
            articles.length > 0
              ? articles
                  .map((article, index) =>
                    renderArticleCard(article, index + 1)
                  )
                  .join("")
              : '<p class="text-center text-slate-400 py-8">No articles found.</p>'
          }</div>`;
          lucide.createIcons();
        }

        function renderTrending() {
          const trendingArticles = [...db.articles].sort(
            (a, b) => (b.views || 0) - (a.views || 0)
          );
          renderHome(trendingArticles, "Trending Posts");
        }

        function renderFollowingFeed() {
          if (!currentUser) return;
          const followingIds = currentUser.profile.following || [];
          const feedArticles = db.articles.filter((article) =>
            followingIds.includes(article.authorId)
          );
          renderHome(feedArticles, "Posts from users you follow");
        }

        function renderArticleCard(article, index) {
          const author = getUser(article.authorId);
          const isLiked =
            currentUser &&
            article.likes &&
            article.likes.includes(currentUser.uid);
          return `<div class="glass-card rounded-xl p-4 flex flex-col sm:flex-row items-stretch sm:items-center gap-4 sm:gap-6"><span class="hidden sm:block text-3xl font-bold text-slate-600">${String(
            index
          ).padStart(2, "0")}</span><img src="${
            article.image
          }" alt="Article thumbnail" class="w-full h-40 sm:w-40 sm:h-24 object-cover rounded-lg flex-shrink-0"><div class="flex-1"><a href="#" class="block text-lg font-semibold text-white hover:text-blue-400 transition-colors article-link" data-id="${
            article.id
          }">${
            article.title
          }</a><div class="text-sm text-slate-400 mt-2 flex items-center gap-4 flex-wrap"><span class="whitespace-nowrap"><i data-lucide="eye" class="inline w-4 h-4 mr-1"></i>${(
            article.views || 0
          ).toLocaleString()} views</span><span class="whitespace-nowrap"><i data-lucide="thumbs-up" class="inline w-4 h-4 mr-1"></i>${
            article.likes ? article.likes.length : 0
          } likes</span>${
            article.category
              ? `<span class="bg-slate-700/50 px-2 py-0.5 rounded text-xs whitespace-nowrap">${article.category}</span>`
              : ""
          }</div><div class="mt-3 flex items-center gap-3"><img src="${
            author?.avatar
          }" alt="${
            author?.name
          }" class="w-8 h-8 rounded-full"><div><span class="text-white font-medium">${
            author?.name || "Unknown"
          }</span><span class="text-slate-400 text-sm block">${timeAgo(
            article.createdAt
          )}</span></div></div></div><button class="like-btn p-2 rounded-full self-end sm:self-start ${
            isLiked
              ? "text-red-500 bg-red-500/10"
              : "text-slate-400 hover:bg-slate-700"
          }" data-id="${
            article.id
          }"><i data-lucide="heart"></i></button></div>`;
        }

        function renderArticleDetail(articleId) {
          const article = db.articles.find((a) => a.id === articleId);
          if (!article) {
            switchView("home");
            return;
          }
          const author = getUser(article.authorId);
          const isLiked =
            currentUser &&
            article.likes &&
            article.likes.includes(currentUser.uid);
          const viewedArticles = JSON.parse(
            sessionStorage.getItem("viewedArticles") || "[]"
          );
          if (!viewedArticles.includes(articleId)) {
            saveArticle(articleId, {
              ...article,
              views: (article.views || 0) + 1,
            });
            viewedArticles.push(articleId);
            sessionStorage.setItem(
              "viewedArticles",
              JSON.stringify(viewedArticles)
            );
          }
          views.article.innerHTML = `<div class="max-w-4xl mx-auto" data-article-id="${
            article.id
          }"><button id="back-to-home" class="flex items-center gap-2 text-slate-400 hover:text-white mb-6"><i data-lucide="arrow-left"></i> Back to Discover</button><h1 class="text-3xl md:text-4xl font-bold text-white mb-4">${
            article.title
          }</h1><div class="flex flex-col gap-4 sm:flex-row items-start sm:items-center justify-between mb-6"><div class="flex items-center gap-4"><img src="${
            author?.avatar
          }" alt="${
            author?.name
          }" class="w-12 h-12 rounded-full"><div><p class="text-white font-semibold text-lg">${
            author?.name || "Unknown"
          }</p><p class="text-slate-400">${timeAgo(
            article.createdAt
          )}</p></div></div>${
            currentUser && article.authorId === currentUser.uid
              ? `<div class="flex gap-2"><button class="edit-article-btn p-2 rounded-lg bg-slate-700 hover:bg-slate-600" data-id="${article.id}"><i data-lucide="edit"></i></button><button class="delete-article-btn p-2 rounded-lg bg-red-800 hover:bg-red-700" data-id="${article.id}"><i data-lucide="trash-2"></i></button></div>`
              : ""
          }</div><img src="${
            article.image
          }" class="w-full h-64 sm:h-96 object-cover rounded-xl mb-8"><div class="prose prose-invert prose-lg max-w-none text-slate-300">${article.content.replace(
            /\n/g,
            "<br><br>"
          )}</div><div class="mt-8 pt-6 border-t border-slate-700 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4"><div class="flex items-center gap-4 text-slate-400"><button class="like-btn flex items-center gap-2 px-4 py-2 rounded-lg ${
            isLiked ? "text-red-500 bg-red-500/10" : "hover:bg-slate-700"
          }" data-id="${
            article.id
          }"><i data-lucide="heart"></i> <span class="like-count">${
            article.likes ? article.likes.length : 0
          }</span> Likes</button><div class="flex items-center gap-2"><i data-lucide="message-square"></i> ${
            db.comments.filter((c) => c.articleId === article.id).length
          } Comments</div></div><button class="share-btn flex items-center justify-center gap-2 px-4 py-2 rounded-lg hover:bg-slate-700" data-id="${
            article.id
          }"><i data-lucide="share-2"></i> Share</button></div><div id="comments-section" class="mt-10">${renderCommentsSection(
            articleId
          )}</div></div>`;
          switchView("article");
          lucide.createIcons();
        }

        function renderCommentsList(articleId) {
          const articleComments = db.comments
            .filter((c) => c.articleId === articleId)
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          return articleComments.length > 0
            ? articleComments
                .map((comment) => {
                  const author = getUser(comment.authorId);
                  return `<div class="flex gap-4"><img src="${
                    author?.avatar
                  }" class="w-10 h-10 rounded-full mt-1"><div class="flex-1"><div class="glass-card p-3 rounded-lg"><div class="flex justify-between items-center"><p class="font-semibold text-white">${
                    author?.name || "Unknown"
                  }</p><span class="text-xs text-slate-400">${timeAgo(
                    comment.createdAt
                  )}</span></div><p class="text-slate-300 mt-1">${
                    comment.content
                  }</p></div></div></div>`;
                })
                .join("")
            : `<p class="text-slate-400 text-center py-4">No comments yet.</p>`;
        }

        function renderCommentsSection(articleId) {
          return `<h3 class="text-2xl font-bold text-white mb-6">Comments</h3><div class="glass-card p-4 rounded-lg"><textarea id="new-comment-input" class="w-full bg-slate-800 border-slate-700 rounded-lg p-3 text-white" rows="3" placeholder="Write a comment..."></textarea><div class="text-right mt-2"><button id="submit-comment-btn" data-id="${articleId}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Post Comment</button></div></div><div id="comments-list" class="mt-6 space-y-4">${renderCommentsList(
            articleId
          )}</div>`;
        }

        function renderCreateEditForm(articleId = null) {
          const article = articleId
            ? db.articles.find((a) => a.id === articleId)
            : null;
          const formTitle = article ? "Edit Article" : "Create New Post";
          const categories = [
            "Technology",
            "Travel",
            "Lifestyle",
            "Food",
            "Health",
          ];
          views.createEdit.innerHTML = `<div class="max-w-4xl mx-auto"><h2 class="text-3xl font-bold text-white mb-6">${formTitle}</h2><form id="article-form" data-editing-id="${
            articleId || ""
          }"><div class="mb-4"><label for="title" class="block text-slate-400 mb-2">Title</label><input type="text" id="title" name="title" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${
            article ? article.title : ""
          }" required></div><div class="mb-4"><label for="content" class="block text-slate-400 mb-2">Content</label><textarea id="content" name="content" rows="10" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required>${
            article ? article.content : ""
          }</textarea></div>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <label for="image" class="block text-slate-400">Image URL</label>
                    <a href="https://postimages.org/" target="_blank" class="text-sm bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded-lg flex items-center gap-2">
                        Upload Image <i data-lucide="upload-cloud" class="w-4 h-4"></i>
                    </a>
                </div>
                <input type="url" id="image" name="image" placeholder="Paste image link here..." class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${
                  article ? article.image : ""
                }" required>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div><label for="category" class="block text-slate-400 mb-2">Category</label><select id="category" name="category" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" required><option value="">Select a category</option>${categories
              .map(
                (cat) =>
                  `<option value="${cat}" ${
                    article && article.category === cat ? "selected" : ""
                  }>${cat}</option>`
              )
              .join(
                ""
              )}</select></div><div><label for="tags" class="block text-slate-400 mb-2">Tags (comma-separated)</label><input type="text" id="tags" name="tags" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${
            article && article.tags ? article.tags.join(", ") : ""
          }"></div></div><div class="flex justify-end gap-4"><button type="button" id="cancel-edit-btn" class="px-6 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Cancel</button><button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 hover:bg-blue-700">${
            article ? "Save Changes" : "Publish Post"
          }</button></div></form></div>`;
          switchView("createEdit");
          lucide.createIcons();
        }

        function renderProfile(userId) {
          const user = getUser(userId);
          if (!user) {
            switchView("home");
            return;
          }
          const userArticles = db.articles
            .filter((a) => a.authorId === userId)
            .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          const isFollowing =
            currentUser &&
            currentUser.profile.following &&
            currentUser.profile.following.includes(userId);
          views.profile.innerHTML = `<div class="max-w-5xl mx-auto"><div class="glass-card rounded-xl p-8 flex flex-col md:flex-row items-center gap-8"><img src="${
            user.avatar
          }" class="w-32 h-32 rounded-full border-4 border-slate-600"><div class="flex-1 text-center md:text-left"><h2 class="text-3xl font-bold text-white">${
            user.name
          }</h2><p class="text-slate-400">@${
            user.username
          }</p><div class="flex justify-center md:justify-start gap-6 mt-4 text-slate-400"><span><strong class="text-white">${
            userArticles.length
          }</strong> Posts</span><span><strong class="text-white">${
            user.followers ? user.followers.length : 0
          }</strong> Followers</span><span><strong class="text-white">${
            user.following ? user.following.length : 0
          }</strong> Following</span></div></div>${
            currentUser && currentUser.uid === userId
              ? `<button id="edit-profile-btn" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Edit Profile</button>`
              : `<button class="follow-btn ${
                  isFollowing
                    ? "bg-slate-700 hover:bg-slate-600"
                    : "bg-blue-600 hover:bg-blue-700"
                } px-4 py-2 rounded-lg" data-id="${userId}">${
                  isFollowing ? "Unfollow" : "Follow"
                }</button>`
          }</div><h3 class="text-2xl font-bold text-white mt-10 mb-6">Articles by ${
            user.name
          }</h3><div class="space-y-4">${
            userArticles.length > 0
              ? userArticles
                  .map((article, index) =>
                    renderArticleCard(article, index + 1)
                  )
                  .join("")
              : '<p class="text-slate-400 text-center py-4">This user hasn\'t posted anything yet.</p>'
          }</div></div>`;
          switchView("profile");
          lucide.createIcons();
        }

        function renderEditProfileForm() {
          if (!currentUser) return;
          views.editProfile.innerHTML = `<div class="max-w-2xl mx-auto"><h2 class="text-3xl font-bold text-white mb-6">Edit Profile</h2><form id="edit-profile-form"><div class="mb-4"><label for="edit-name" class="block text-slate-400 mb-2">Display Name</label><input type="text" id="edit-name" name="name" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${currentUser.profile.name}" required></div><div class="mb-4"><label for="edit-username" class="block text-slate-400 mb-2">Username</label><input type="text" id="edit-username" name="username" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${currentUser.profile.username}" required></div>
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <label for="edit-avatar" class="block text-slate-400">Avatar URL</label>
                    <a href="https://postimages.org/" target="_blank" class="text-sm bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded-lg flex items-center gap-2">
                        Upload Avatar <i data-lucide="upload-cloud" class="w-4 h-4"></i>
                    </a>
                </div>
                <input type="url" id="edit-avatar" name="avatar" placeholder="Paste image link here..." class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" value="${currentUser.profile.avatar}" required>
            </div>
            <div class="flex justify-end gap-4"><button type="button" id="cancel-profile-edit-btn" class="px-6 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Cancel</button><button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 hover:bg-blue-700">Save Changes</button></div></form></div>`;
          switchView("editProfile");
          lucide.createIcons();
        }

        // --- THIS IS THE FIXED FUNCTION ---
        function renderSearchResults(query) {
          const lowerQuery = query.toLowerCase();

          const foundArticles = db.articles.filter(
            (a) =>
              (a.title && a.title.toLowerCase().includes(lowerQuery)) ||
              (a.content && a.content.toLowerCase().includes(lowerQuery)) ||
              (a.tags &&
                a.tags.some((t) => t.toLowerCase().includes(lowerQuery)))
          );
          const foundAuthors = db.users.filter(
            (u) =>
              (u.name && u.name.toLowerCase().includes(lowerQuery)) ||
              (u.username && u.username.toLowerCase().includes(lowerQuery))
          );

          views.searchResults.innerHTML = `<h2 class="text-3xl font-bold text-white mb-6">Search Results for "${query}"</h2>${
            foundAuthors.length > 0
              ? `<h3 class="text-xl font-semibold text-white mb-4">Authors</h3><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">${foundAuthors
                  .map(
                    (user) =>
                      `<div class="glass-card p-4 rounded-lg text-center flex flex-col items-center"><img src="${user.avatar}" class="w-20 h-20 rounded-full mx-auto mb-2"><p class="text-white font-semibold">${user.name}</p><p class="text-slate-400 text-sm">@${user.username}</p><button class="view-profile-btn mt-2 text-sm text-blue-400 hover:underline" data-id="${user.id}">View Profile</button></div>`
                  )
                  .join("")}</div>`
              : ""
          }<h3 class="text-xl font-semibold text-white mb-4">Articles</h3><div class="space-y-4">${
            foundArticles.length > 0
              ? foundArticles
                  .map((article, index) =>
                    renderArticleCard(article, index + 1)
                  )
                  .join("")
              : '<p class="text-slate-400 text-center py-4">No articles found.</p>'
          }</div>`;
          switchView("searchResults");
          lucide.createIcons();
        }
        // --- END OF FIXED FUNCTION ---

        function renderSidebars() {
          const popularAuthorsList = document.getElementById(
            "popular-authors-list"
          );
          if (!popularAuthorsList) return;
          const sortedAuthors = [...db.users]
            .sort(
              (a, b) => (b.followers?.length || 0) - (a.followers?.length || 0)
            )
            .slice(0, 4);
          popularAuthorsList.innerHTML = sortedAuthors
            .map(
              (user) =>
                `<div class="flex items-center justify-between"><div class="flex items-center gap-3"><img src="${
                  user.avatar
                }" class="w-10 h-10 rounded-full"><div><p class="font-semibold text-white">${
                  user.name
                }</p><p class="text-sm text-slate-400">${(
                  user.followers?.length || 0
                ).toLocaleString()} followers</p></div></div><button class="view-profile-btn text-blue-500 text-sm font-semibold hover:underline" data-id="${
                  user.id
                }">View</button></div>`
            )
            .join("");
          const popularTagsList = document.getElementById("popular-tags-list");
          if (!popularTagsList) return;
          const allTags = db.articles.flatMap((a) => a.tags || []);
          const tagCounts = allTags.reduce((acc, tag) => {
            acc[tag] = (acc[tag] || 0) + 1;
            return acc;
          }, {});
          const sortedTags = Object.entries(tagCounts)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 8);
          popularTagsList.innerHTML = sortedTags
            .map(
              ([tag]) =>
                `<button class="tag-link bg-slate-700/80 px-3 py-1 rounded-full text-sm hover:bg-slate-600 transition-colors" data-tag="${tag}">${tag}</button>`
            )
            .join("");
        }

        function handleMobileSidebar() {
          const leftSidebar = document.getElementById("left-sidebar");
          const sidebarOverlay = document.getElementById("sidebar-overlay");
          function closeSidebar() {
            leftSidebar.classList.add("-translate-x-full");
            sidebarOverlay.classList.add("hidden");
          }
          document
            .getElementById("sidebar-toggle")
            .addEventListener("click", () => {
              leftSidebar.classList.remove("-translate-x-full");
              sidebarOverlay.classList.remove("hidden");
            });
          document
            .getElementById("close-sidebar")
            .addEventListener("click", closeSidebar);
          sidebarOverlay.addEventListener("click", closeSidebar);
        }

        function closeSidebarIfMobile() {
          if (window.innerWidth < 768) {
            document
              .getElementById("left-sidebar")
              .classList.add("-translate-x-full");
            document.getElementById("sidebar-overlay").classList.add("hidden");
          }
        }

        document.body.addEventListener("click", (e) => {
          const target = e.target.closest("a, button");
          if (!target) return;
          if (target.matches(".article-link")) {
            e.preventDefault();
            renderArticleDetail(target.dataset.id);
          }
          if (target.matches("#back-to-home")) {
            e.preventDefault();
            renderHome();
            switchView("home");
          }
          if (target.matches(".like-btn")) {
            handleLike(target.dataset.id);
          }
          if (target.matches("#submit-comment-btn")) {
            handleCommentSubmit(target.dataset.id);
          }
          if (target.matches("#create-post-btn")) {
            renderCreateEditForm();
          }
          if (target.matches(".edit-article-btn")) {
            renderCreateEditForm(target.dataset.id);
          }
          if (target.matches(".delete-article-btn")) {
            handleDeleteArticle(target.dataset.id);
          }
          if (target.matches("#cancel-edit-btn")) {
            const editingId =
              document.getElementById("article-form").dataset.editingId;
            if (editingId) renderArticleDetail(editingId);
            else {
              renderHome();
              switchView("home");
            }
          }
          if (target.matches(".view-profile-btn, #user-profile-header")) {
            e.preventDefault();
            const userId = target.dataset.id || currentUser?.uid;
            if (userId) {
              renderProfile(userId);
              closeSidebarIfMobile();
            }
          }
          if (target.matches(".follow-btn")) {
            handleFollow(target.dataset.id);
          }
          if (target.matches(".tag-link")) {
            const tag = target.dataset.tag;
            const taggedArticles = db.articles.filter(
              (a) => a.tags && a.tags.includes(tag)
            );
            renderHome(taggedArticles, `Posts tagged #${tag}`);
          }
          if (target.matches("#show-register")) {
            e.preventDefault();
            renderRegisterView();
            switchView("register");
          }
          if (target.matches("#show-login")) {
            e.preventDefault();
            renderLoginView();
            switchView("login");
          }
          if (target.matches("#edit-profile-btn")) {
            renderEditProfileForm();
          }
          if (target.matches("#cancel-profile-edit-btn")) {
            renderProfile(currentUser.uid);
          }
          if (target.matches("#nav-home")) {
            e.preventDefault();
            renderHome();
            switchView("home");
            closeSidebarIfMobile();
          }
          if (target.matches("#nav-trending")) {
            e.preventDefault();
            renderTrending();
            switchView("home");
            closeSidebarIfMobile();
          }
          if (target.matches("#nav-following")) {
            e.preventDefault();
            renderFollowingFeed();
            switchView("home");
            closeSidebarIfMobile();
          }
          if (target.matches("#nav-profile")) {
            e.preventDefault();
            renderProfile(currentUser.uid);
            closeSidebarIfMobile();
          }
          if (target.matches("#logout-btn")) {
            handleLogout();
          }
          if (target.matches(".share-btn")) {
            handleShare(target.dataset.id);
          }
          if (target.matches("#close-share-modal")) {
            document.getElementById("share-modal").classList.add("hidden");
          }
          if (target.matches("#copy-share-url")) {
            const input = document.getElementById("share-url-input");
            input.select();
            document.execCommand("copy");
            const feedback = document.getElementById("copy-feedback");
            feedback.style.opacity = "1";
            setTimeout(() => {
              feedback.style.opacity = "0";
            }, 2000);
          }
          const categoryLink = e.target.closest(".category-link");
          if (categoryLink) {
            e.preventDefault();
            const category = categoryLink.dataset.category;
            const categoryArticles = db.articles.filter(
              (a) => a.category === category
            );
            renderHome(categoryArticles, category);
            closeSidebarIfMobile();
          }
        });

        document
          .getElementById("share-modal")
          .addEventListener("click", (e) => {
            if (e.target.id === "share-modal")
              e.currentTarget.classList.add("hidden");
          });

        mainContentArea.addEventListener("submit", (e) => {
          e.preventDefault();
          if (e.target.id === "login-form") handleLogin(e);
          if (e.target.id === "register-form") handleRegister(e);
          if (e.target.id === "article-form") handleArticleFormSubmit(e);
          if (e.target.id === "edit-profile-form") handleProfileEditSubmit(e);
        });

        document.getElementById("search-bar").addEventListener("keyup", (e) => {
          if (e.key === "Enter") {
            const query = e.target.value.trim();
            if (query) {
              renderSearchResults(query);
            } else {
              renderHome();
              switchView("home");
            }
          }
        });

        function handleLike(articleId) {
          if (!currentUser) return alert("Please log in to like posts.");
          const article = db.articles.find((a) => a.id === articleId);
          if (!article) return;
          let likes = article.likes || [];
          const likeIndex = likes.indexOf(currentUser.uid);
          if (likeIndex > -1) likes.splice(likeIndex, 1);
          else likes.push(currentUser.uid);
          saveArticle(articleId, { ...article, likes: likes });
        }

        function handleCommentSubmit(articleId) {
          if (!currentUser) return alert("Please log in to comment.");
          const content = document
            .getElementById("new-comment-input")
            .value.trim();
          if (content) {
            const newCommentId = "comment" + Date.now();
            saveComment(newCommentId, {
              articleId,
              authorId: currentUser.uid,
              content,
              createdAt: new Date().toISOString(),
            }).then(
              () => (document.getElementById("new-comment-input").value = "")
            );
          }
        }

        function handleDeleteArticle(articleId) {
          if (confirm("Are you sure you want to delete this article?")) {
            deleteArticle(articleId);
            db.comments
              .filter((c) => c.articleId === articleId)
              .forEach((comment) => dbRef.comments.child(comment.id).remove());
            renderHome();
            switchView("home");
          }
        }

        function handleArticleFormSubmit(e) {
          const formData = new FormData(e.target);
          const editingId = e.target.dataset.editingId;
          const existingArticle = editingId
            ? db.articles.find((a) => a.id === editingId)
            : {};
          const articleData = {
            title: formData.get("title"),
            content: formData.get("content"),
            image: formData.get("image"),
            category: formData.get("category"),
            tags: formData
              .get("tags")
              .split(",")
              .map((t) => t.trim())
              .filter(Boolean),
            authorId: currentUser.uid,
            createdAt: editingId
              ? existingArticle.createdAt
              : new Date().toISOString(),
            likes: existingArticle.likes || [],
            views: existingArticle.views || 0,
          };
          const idToSave = editingId || "article" + Date.now();
          saveArticle(idToSave, articleData).then(() => {
            if (editingId) renderArticleDetail(editingId);
            else {
              renderHome();
              switchView("home");
            }
          });
        }

        function handleProfileEditSubmit(e) {
          const formData = new FormData(e.target);
          const updatedProfile = {
            ...currentUser.profile,
            name: formData.get("name"),
            username: formData.get("username"),
            avatar: formData.get("avatar"),
          };
          saveUser(currentUser.uid, updatedProfile).then(() =>
            renderProfile(currentUser.uid)
          );
        }

        function handleFollow(targetUserId) {
          if (!currentUser) return alert("Please log in to follow users.");
          const targetUser = getUser(targetUserId);
          if (!targetUser) return;
          let currentUserFollowing = currentUser.profile.following || [];
          const followingIndex = currentUserFollowing.indexOf(targetUserId);
          if (followingIndex > -1)
            currentUserFollowing.splice(followingIndex, 1);
          else currentUserFollowing.push(targetUserId);
          let targetUserFollowers = targetUser.followers || [];
          const followerIndex = targetUserFollowers.indexOf(currentUser.uid);
          if (followerIndex > -1) targetUserFollowers.splice(followerIndex, 1);
          else targetUserFollowers.push(currentUser.uid);
          saveUser(currentUser.uid, {
            ...currentUser.profile,
            following: currentUserFollowing,
          });
          saveUser(targetUserId, {
            ...targetUser,
            followers: targetUserFollowers,
          });
        }

        function handleShare(articleId) {
          const article = db.articles.find((a) => a.id === articleId);
          const url =
            window.location.href.split("#")[0] + `#article/${articleId}`;
          const text = `Check out this article: ${article.title}`;
          const shareModal = document.getElementById("share-modal");

          shareModal.querySelector(
            ".share-link-twitter"
          ).href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(
            url
          )}&text=${encodeURIComponent(text)}`;
          shareModal.querySelector(
            ".share-link-facebook"
          ).href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
            url
          )}`;
          shareModal.querySelector(
            ".share-link-linkedin"
          ).href = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(
            url
          )}&title=${encodeURIComponent(article.title)}`;
          shareModal.querySelector(
            ".share-link-whatsapp"
          ).href = `https://api.whatsapp.com/send?text=${encodeURIComponent(
            text + " " + url
          )}`;
          shareModal.querySelector("#share-url-input").value = url;
          shareModal.classList.remove("hidden");
        }

        // --- INITIALIZATION ---
        initDatabaseListeners();
      });
    </script>
  </body>
</html>
